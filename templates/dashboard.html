<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-3">

{% if role=="user" %}
<div class="card shadow-sm mb-3">
  <div class="card-header bg-primary text-white text-center">
    üë§ TH√îNG TIN NH√ÇN VI√äN
  </div>

  <ul class="list-group list-group-flush">
    <li class="list-group-item"><b>M√£ NV:</b> {{ nv.Ma_NV }}</li>
    <li class="list-group-item"><b>H·ªç t√™n:</b> {{ nv.Ho_ten }}</li>
    <li class="list-group-item"><b>BP:</b> {{ nv.BP }}</li>
    <li class="list-group-item"><b>B·ªô ph·∫≠n KK:</b> {{ nv.Bo_phan_KK }}</li>
    <li class="list-group-item"><b>Lo·∫°i h√†ng:</b> {{ nv.Loai_hang }}</li>
    <li class="list-group-item"><b>Nh√≥m:</b> {{ nv.Nhom }}</li>
    <li class="list-group-item"><b>ƒê·ªôi:</b> {{ nv.Doi }}</li>
    <li class="list-group-item"><b>Vai tr√≤:</b> {{ nv.Vai_tro }}</li>
    <li class="list-group-item"><b>SƒêT:</b> {{ nv.SDT }}</li>
  </ul>
</div>

<div class="card shadow-sm">
  <div class="card-header bg-success text-white text-center">
    üìã TR·∫†NG TH√ÅI KI·ªÇM K√ä
  </div>

  <div class="card-body">
    <p>
      Tr·∫°ng th√°i hi·ªán t·∫°i:
      <span class="badge bg-info">{{ trang_thai }}</span>
    </p>

    <form method="post" action="/user/checkin">
      <label class="form-label">C·∫≠p nh·∫≠t tr·∫°ng th√°i</label>
      <select name="Trang_thai" class="form-select mb-3">
        <option value="ƒêang KK">ƒêang KK</option>
        <option value="K·∫øt th√∫c KK">K·∫øt th√∫c KK</option>
      </select>

      <button class="btn btn-success w-100">
        ‚úî C·∫≠p nh·∫≠t ki·ªÉm k√™
      </button>
    </form>
  </div>
</div>
{% endif %}


{% if role=="admin" %}
<h4 class="mb-3 text-center">üìä DASHBOARD KI·ªÇM K√ä</h4>

<!-- ===== SUMMARY CARDS ===== -->
<div class="row g-2 mb-3">
  <div class="col-6">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <h6>T·ªïng NV</h6>
        <h3 class="text-primary">
          {{ stat | sum(attribute='Tong') }}
        </h3>
      </div>
    </div>
  </div>

  <div class="col-6">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <h6>ƒê√£ KK</h6>
        <h3 class="text-success">
          {{ stat | sum(attribute='Ket_thuc') }}
        </h3>
      </div>
    </div>
  </div>

  <div class="col-6">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <h6>ƒêang KK</h6>
        <h3 class="text-warning">
          {{ stat | sum(attribute='Dang_KK') }}
        </h3>
      </div>
    </div>
  </div>

  <div class="col-6">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <h6>Ti·∫øn ƒë·ªô</h6>
        <h3 class="text-info">
          {{
            (
              stat | sum(attribute='Ket_thuc')
              /
              stat | sum(attribute='Tong')
              * 100
            ) | round(1)
          }}%
        </h3>
      </div>
    </div>
  </div>
</div>

<!-- ===== TABLE ===== -->
<div class="card shadow-sm">
  <div class="card-header bg-dark text-white text-center">
    üìã TI·∫æN ƒê·ªò THEO B·ªò PH·∫¨N
  </div>

  <div class="table-responsive">
    <table class="table table-bordered align-middle mb-0">
      <thead class="table-light text-center">
        <tr>
          <th>B·ªô ph·∫≠n</th>
          <th>T·ªïng</th>
          <th>ƒêang KK</th>
          <th>K·∫øt th√∫c</th>
          <th>Ti·∫øn ƒë·ªô</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for r in stat %}
        <tr>
          <td>{{ r.Bo_phan_KK }}</td>
          <td class="text-center">{{ r.Tong }}</td>
          <td class="text-center text-warning">{{ r.Dang_KK }}</td>
          <td class="text-center text-success">{{ r.Ket_thuc }}</td>
          <td>
            <div class="progress" style="height: 18px;">
              <div class="progress-bar bg-success"
                   style="width: {{ r.Tien_do }}%;">
                {{ r.Tien_do }}%
              </div>
            </div>
          </td>
          <td class="text-center">
            <a href="/admin/export/{{ r.Bo_phan_KK }}"
               class="btn btn-sm btn-outline-primary">
               ‚¨á Xu·∫•t
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<a href="/admin/export_all"
   class="btn btn-danger w-100 mt-3">
  ‚¨á Xu·∫•t to√†n b·ªô k·∫øt qu·∫£
</a>
{% endif %}

</div>
</body>
</html>


